<div class="page-container">

  <!-- SIDEBAR / FILTERS -->
  <aside class="sidebar">
    <div class="filter-card">

      <div class="filter-header">
        <h3>Filters</h3>
        <button
          mat-button
          color="warn"
          (click)="clearFilters()"
          *ngIf="searchTitle || filterLocation || filterType">
          Clear
        </button>
      </div>

      <!-- SEARCH TITLE -->
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Search Title</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input
          matInput
          [(ngModel)]="searchTitle"
          [matAutocomplete]="auto"
          (input)="onSearchInput()"
          (keyup.enter)="applyFilters()"
          placeholder="e.g. Engineer" />

        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="applyFilters()">
          <mat-option *ngFor="let title of suggestedTitles" [value]="title">
            {{ title }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <!-- LOCATION -->
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Location</mat-label>
        <mat-select [(ngModel)]="filterLocation" (selectionChange)="applyFilters()">
          <mat-option value="">All Locations</mat-option>
          <mat-option *ngFor="let loc of locations" [value]="loc">
            {{ loc }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- JOB TYPE -->
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Job Type</mat-label>
        <mat-select [(ngModel)]="filterType" (selectionChange)="applyFilters()">
          <mat-option value="">All Types</mat-option>
          <mat-option *ngFor="let type of jobTypes" [value]="type">
            {{ type }}
          </mat-option>
        </mat-select>
      </mat-form-field>

    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">

    <!-- LOADING -->
    <div class="loading-container" *ngIf="isLoading">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading jobs...</p>
    </div>

    <!-- ERROR -->
    <div class="error-container" *ngIf="errorMessage">
      <mat-icon color="warn">error</mat-icon>
      <p>{{ errorMessage }}</p>
      <button mat-button color="primary" (click)="ngOnInit()">Retry</button>
    </div>

    <!-- RESULTS -->
    <ng-container *ngIf="!isLoading && !errorMessage">

      <div class="results-header">
        <h2>
          {{ filteredJobs.length }}
          {{ (searchTitle || filterLocation || filterType) ? 'Matching Jobs' : 'Available Jobs' }}
        </h2>

        <p class="text-secondary" *ngIf="searchTitle || filterLocation || filterType; else defaultText">
          Found matches for your search criteria
        </p>

        <ng-template #defaultText>
          <p class="text-secondary">Explore all open positions</p>
        </ng-template>
      </div>

      <!-- JOB LIST -->
      <div class="job-grid" *ngIf="filteredJobs.length > 0; else noJobs">

        <mat-card class="job-card" *ngFor="let job of filteredJobs">

          <div class="card-body">

            <div class="job-header">
              <div>
                <mat-card-title>{{ job.title }}</mat-card-title>
                <mat-card-subtitle class="company-name">
                  Tech Company #{{ job.companyId }}
                </mat-card-subtitle>
              </div>

              <div class="salary-badge">
                {{ job.salary | currency:'INR':'symbol':'1.0-0' }}
              </div>
            </div>

            <div class="chips-container">
              <span class="chip">
                <mat-icon>place</mat-icon> {{ job.location }}
              </span>
              <span class="chip">
                <mat-icon>work</mat-icon> {{ job.type }}
              </span>
              <span class="chip">
                <mat-icon>schedule</mat-icon> {{ job.postedDate | date }}
              </span>
            </div>

            <p class="job-description">
              {{ job.description | slice:0:120 }}...
            </p>

          </div>

          <mat-divider></mat-divider>

          <mat-card-actions align="end">
            <button mat-button color="primary" [routerLink]="['/jobs', job.id]">
              VIEW DETAILS
            </button>
            <button mat-flat-button color="primary" [routerLink]="['/apply', job.id]">
              APPLY NOW
            </button>
          </mat-card-actions>

        </mat-card>

      </div>

      <!-- EMPTY STATE -->
      <ng-template #noJobs>
        <div class="empty-state">
          <mat-icon>sentiment_dissatisfied</mat-icon>
          <h3>No jobs found matching criteria</h3>
          <button mat-stroked-button color="primary" (click)="clearFilters()">
            Clear Filters
          </button>
        </div>
      </ng-template>

    </ng-container>

  </main>
</div>
